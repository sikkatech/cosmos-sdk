(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{810:function(l,Z,d){"use strict";d.r(Z);var c=d(1),X=Object(c.a)({},(function(){var l=this,Z=l.$createElement,d=l._self._c||Z;return d("ContentSlotsDistributor",{attrs:{"slot-key":l.$parent.slotKey}},[d("h1",{attrs:{id:"module-simulation"}},[d("a",{staticClass:"header-anchor",attrs:{href:"#module-simulation"}},[l._v("#")]),l._v(" Module Simulation")]),l._v(" "),d("h2",{attrs:{id:"prerequisites"}},[d("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[l._v("#")]),l._v(" Prerequisites")]),l._v(" "),d("ul",[d("li",[d("RouterLink",{attrs:{to:"/using-the-sdk/simulation.html"}},[l._v("Cosmos Blockchain Simulator")])],1)]),l._v(" "),d("h2",{attrs:{id:"synopsis"}},[d("a",{staticClass:"header-anchor",attrs:{href:"#synopsis"}},[l._v("#")]),l._v(" Synopsis")]),l._v(" "),d("p",[l._v("This document details how to define each module simulation functions to be\nintegrated with the application "),d("code",[l._v("SimulationManager")]),l._v(".")]),l._v(" "),d("ul",[d("li",[d("a",{attrs:{href:"#simulation-package"}},[l._v("Simulation package")]),l._v(" "),d("ul",[d("li",[d("a",{attrs:{href:"#store-decoders"}},[l._v("Store decoders")])]),l._v(" "),d("li",[d("a",{attrs:{href:"#randomized-genesis"}},[l._v("Randomized genesis")])]),l._v(" "),d("li",[d("a",{attrs:{href:"#randomized-parameters"}},[l._v("Randomized parameters")])]),l._v(" "),d("li",[d("a",{attrs:{href:"#random-weighted-operations"}},[l._v("Random weighted operations")])]),l._v(" "),d("li",[d("a",{attrs:{href:"#random-proposal-contents"}},[l._v("Random proposal contents")])])])]),l._v(" "),d("li",[d("a",{attrs:{href:"#registering-simulation-functions"}},[l._v("Registering the module simulation functions")])]),l._v(" "),d("li",[d("a",{attrs:{href:"#app-simulator-manager"}},[l._v("App simulator manager")])]),l._v(" "),d("li",[d("a",{attrs:{href:"#simulation-tests"}},[l._v("Simulation tests")])])]),l._v(" "),d("h2",{attrs:{id:"simulation-package"}},[d("a",{staticClass:"header-anchor",attrs:{href:"#simulation-package"}},[l._v("#")]),l._v(" Simulation package")]),l._v(" "),d("p",[l._v("Every module that implements the SDK simulator needs to have a "),d("code",[l._v("x/<module>/simulation")]),l._v("\npackage which contains the primary functions required by the fuzz tests: store\ndecoders, randomized genesis state and parameters, weighted operations and proposal\ncontents.")]),l._v(" "),d("h3",{attrs:{id:"store-decoders"}},[d("a",{staticClass:"header-anchor",attrs:{href:"#store-decoders"}},[l._v("#")]),l._v(" Store decoders")]),l._v(" "),d("p",[l._v("Registering the store decoders is required for the "),d("code",[l._v("AppImportExport")]),l._v(". This allows\nfor the key-value pairs from the stores to be decoded ("),d("em",[l._v("i.e")]),l._v(" unmarshalled)\nto their corresponding types. In particular, it matches the key to a concrete type\nand then unmarshals the value from the "),d("code",[l._v("KVPair")]),l._v(" to the type provided.")]),l._v(" "),d("p",[l._v("You can use the example "),d("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/release%2Fv0.38.0/x/distribution/simulation/decoder.go",target:"_blank",rel:"noopener noreferrer"}},[l._v("here"),d("OutboundLink")],1),l._v(" from the distribution module to implement your store decoders.")]),l._v(" "),d("h3",{attrs:{id:"randomized-genesis"}},[d("a",{staticClass:"header-anchor",attrs:{href:"#randomized-genesis"}},[l._v("#")]),l._v(" Randomized genesis")]),l._v(" "),d("p",[l._v("The simulator tests different scenarios and values for genesis parameters\nin order to fully test the edge cases of specific modules. The "),d("code",[l._v("simulator")]),l._v(" package from each module must expose a "),d("code",[l._v("RandomizedGenState")]),l._v(" function to generate the initial random "),d("code",[l._v("GenesisState")]),l._v(" from a given seed.")]),l._v(" "),d("p",[l._v("Once the module genesis parameter are generated randomly (or with the key and\nvalues defined in a "),d("code",[l._v("params")]),l._v(" file), they are marshaled to JSON format and added\nto the app genesis JSON to use it on the simulations.")]),l._v(" "),d("p",[l._v("You can check an example on how to create the randomized genesis "),d("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/release%2Fv0.38.0/x/staking/simulation/genesis.go",target:"_blank",rel:"noopener noreferrer"}},[l._v("here"),d("OutboundLink")],1),l._v(".")]),l._v(" "),d("h3",{attrs:{id:"randomized-parameter-changes"}},[d("a",{staticClass:"header-anchor",attrs:{href:"#randomized-parameter-changes"}},[l._v("#")]),l._v(" Randomized parameter changes")]),l._v(" "),d("p",[l._v("The simulator is able to test parameter changes at random. The simulator package from each module must contain a "),d("code",[l._v("RandomizedParams")]),l._v(" func that will simulate parameter changes of the module throughout the simulations lifespan.")]),l._v(" "),d("p",[l._v("You can see how an example of what is needed to fully test parameter changes "),d("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/release%2Fv0.38.0/x/staking/simulation/params.go",target:"_blank",rel:"noopener noreferrer"}},[l._v("here"),d("OutboundLink")],1)]),l._v(" "),d("h3",{attrs:{id:"random-weighted-operations"}},[d("a",{staticClass:"header-anchor",attrs:{href:"#random-weighted-operations"}},[l._v("#")]),l._v(" Random weighted operations")]),l._v(" "),d("p",[l._v("Operations are one of the crucial parts of the SDK simulation. They are the transactions\n("),d("code",[l._v("Msg")]),l._v(") that are simulated with random field values. The sender of the operation\nis also assigned randomly.")]),l._v(" "),d("p",[l._v("Operations on the simulation are simulated using the full "),d("RouterLink",{attrs:{to:"/core/transactions.html"}},[l._v("transaction cycle")]),l._v(" of a\n"),d("code",[l._v("ABCI")]),l._v(" application that exposes the "),d("code",[l._v("BaseApp")]),l._v(".")],1),l._v(" "),d("p",[l._v("Shown below is how weights are set:")]),l._v(" "),d("p",[d("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cGFja2FnZSBzaW11bGF0aW9uCgppbXBvcnQgKAoJJnF1b3Q7Zm10JnF1b3Q7CgkmcXVvdDttYXRoL3JhbmQmcXVvdDsKCgkmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL2Jhc2VhcHAmcXVvdDsKCSZxdW90O2dpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsvY29kZWMmcXVvdDsKCSZxdW90O2dpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsvc2ltYXBwL2hlbHBlcnMmcXVvdDsKCXNpbWFwcHBhcmFtcyAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3NpbWFwcC9wYXJhbXMmcXVvdDsKCXNkayAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzJnF1b3Q7CglzaW10eXBlcyAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzL3NpbXVsYXRpb24mcXVvdDsKCSZxdW90O2dpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsveC9zaW11bGF0aW9uJnF1b3Q7CgkmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3gvc3Rha2luZy9rZWVwZXImcXVvdDsKCSZxdW90O2dpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsveC9zdGFraW5nL3R5cGVzJnF1b3Q7CikKCi8vIFNpbXVsYXRpb24gb3BlcmF0aW9uIHdlaWdodHMgY29uc3RhbnRzCmNvbnN0ICgKCU9wV2VpZ2h0TXNnQ3JlYXRlVmFsaWRhdG9yID0gJnF1b3Q7b3Bfd2VpZ2h0X21zZ19jcmVhdGVfdmFsaWRhdG9yJnF1b3Q7CglPcFdlaWdodE1zZ0VkaXRWYWxpZGF0b3IgICA9ICZxdW90O29wX3dlaWdodF9tc2dfZWRpdF92YWxpZGF0b3ImcXVvdDsKCU9wV2VpZ2h0TXNnRGVsZWdhdGUgICAgICAgID0gJnF1b3Q7b3Bfd2VpZ2h0X21zZ19kZWxlZ2F0ZSZxdW90OwoJT3BXZWlnaHRNc2dVbmRlbGVnYXRlICAgICAgPSAmcXVvdDtvcF93ZWlnaHRfbXNnX3VuZGVsZWdhdGUmcXVvdDsKCU9wV2VpZ2h0TXNnQmVnaW5SZWRlbGVnYXRlID0gJnF1b3Q7b3Bfd2VpZ2h0X21zZ19iZWdpbl9yZWRlbGVnYXRlJnF1b3Q7CikKCi8vIFdlaWdodGVkT3BlcmF0aW9ucyByZXR1cm5zIGFsbCB0aGUgb3BlcmF0aW9ucyBmcm9tIHRoZSBtb2R1bGUgd2l0aCB0aGVpciByZXNwZWN0aXZlIHdlaWdodHMKZnVuYyBXZWlnaHRlZE9wZXJhdGlvbnMoCglhcHBQYXJhbXMgc2ltdHlwZXMuQXBwUGFyYW1zLCBjZGMgY29kZWMuSlNPTk1hcnNoYWxlciwgYWsgdHlwZXMuQWNjb3VudEtlZXBlciwKCWJrIHR5cGVzLkJhbmtLZWVwZXIsIGsga2VlcGVyLktlZXBlciwKKSBzaW11bGF0aW9uLldlaWdodGVkT3BlcmF0aW9ucyB7Cgl2YXIgKAoJCXdlaWdodE1zZ0NyZWF0ZVZhbGlkYXRvciBpbnQKCQl3ZWlnaHRNc2dFZGl0VmFsaWRhdG9yICAgaW50CgkJd2VpZ2h0TXNnRGVsZWdhdGUgICAgICAgIGludAoJCXdlaWdodE1zZ1VuZGVsZWdhdGUgICAgICBpbnQKCQl3ZWlnaHRNc2dCZWdpblJlZGVsZWdhdGUgaW50CgkpCgoJYXBwUGFyYW1zLkdldE9yR2VuZXJhdGUoY2RjLCBPcFdlaWdodE1zZ0NyZWF0ZVZhbGlkYXRvciwgJmFtcDt3ZWlnaHRNc2dDcmVhdGVWYWxpZGF0b3IsIG5pbCwKCQlmdW5jKF8gKnJhbmQuUmFuZCkgewoJCQl3ZWlnaHRNc2dDcmVhdGVWYWxpZGF0b3IgPSBzaW1hcHBwYXJhbXMuRGVmYXVsdFdlaWdodE1zZ0NyZWF0ZVZhbGlkYXRvcgoJCX0sCgkpCgoJYXBwUGFyYW1zLkdldE9yR2VuZXJhdGUoY2RjLCBPcFdlaWdodE1zZ0VkaXRWYWxpZGF0b3IsICZhbXA7d2VpZ2h0TXNnRWRpdFZhbGlkYXRvciwgbmlsLAoJCWZ1bmMoXyAqcmFuZC5SYW5kKSB7CgkJCXdlaWdodE1zZ0VkaXRWYWxpZGF0b3IgPSBzaW1hcHBwYXJhbXMuRGVmYXVsdFdlaWdodE1zZ0VkaXRWYWxpZGF0b3IKCQl9LAoJKQoKCWFwcFBhcmFtcy5HZXRPckdlbmVyYXRlKGNkYywgT3BXZWlnaHRNc2dEZWxlZ2F0ZSwgJmFtcDt3ZWlnaHRNc2dEZWxlZ2F0ZSwgbmlsLAoJCWZ1bmMoXyAqcmFuZC5SYW5kKSB7CgkJCXdlaWdodE1zZ0RlbGVnYXRlID0gc2ltYXBwcGFyYW1zLkRlZmF1bHRXZWlnaHRNc2dEZWxlZ2F0ZQoJCX0sCgkpCgoJYXBwUGFyYW1zLkdldE9yR2VuZXJhdGUoY2RjLCBPcFdlaWdodE1zZ1VuZGVsZWdhdGUsICZhbXA7d2VpZ2h0TXNnVW5kZWxlZ2F0ZSwgbmlsLAoJCWZ1bmMoXyAqcmFuZC5SYW5kKSB7CgkJCXdlaWdodE1zZ1VuZGVsZWdhdGUgPSBzaW1hcHBwYXJhbXMuRGVmYXVsdFdlaWdodE1zZ1VuZGVsZWdhdGUKCQl9LAoJKQoKCWFwcFBhcmFtcy5HZXRPckdlbmVyYXRlKGNkYywgT3BXZWlnaHRNc2dCZWdpblJlZGVsZWdhdGUsICZhbXA7d2VpZ2h0TXNnQmVnaW5SZWRlbGVnYXRlLCBuaWwsCgkJZnVuYyhfICpyYW5kLlJhbmQpIHsKCQkJd2VpZ2h0TXNnQmVnaW5SZWRlbGVnYXRlID0gc2ltYXBwcGFyYW1zLkRlZmF1bHRXZWlnaHRNc2dCZWdpblJlZGVsZWdhdGUKCQl9LAoJKQoKCXJldHVybiBzaW11bGF0aW9uLldlaWdodGVkT3BlcmF0aW9uc3sKCQlzaW11bGF0aW9uLk5ld1dlaWdodGVkT3BlcmF0aW9uKAoJCQl3ZWlnaHRNc2dDcmVhdGVWYWxpZGF0b3IsCgkJCVNpbXVsYXRlTXNnQ3JlYXRlVmFsaWRhdG9yKGFrLCBiaywgayksCgkJKSwKCQlzaW11bGF0aW9uLk5ld1dlaWdodGVkT3BlcmF0aW9uKAoJCQl3ZWlnaHRNc2dFZGl0VmFsaWRhdG9yLAoJCQlTaW11bGF0ZU1zZ0VkaXRWYWxpZGF0b3IoYWssIGJrLCBrKSwKCQkpLAoJCXNpbXVsYXRpb24uTmV3V2VpZ2h0ZWRPcGVyYXRpb24oCgkJCXdlaWdodE1zZ0RlbGVnYXRlLAoJCQlTaW11bGF0ZU1zZ0RlbGVnYXRlKGFrLCBiaywgayksCgkJKSwKCQlzaW11bGF0aW9uLk5ld1dlaWdodGVkT3BlcmF0aW9uKAoJCQl3ZWlnaHRNc2dVbmRlbGVnYXRlLAoJCQlTaW11bGF0ZU1zZ1VuZGVsZWdhdGUoYWssIGJrLCBrKSwKCQkpLAoJCXNpbXVsYXRpb24uTmV3V2VpZ2h0ZWRPcGVyYXRpb24oCgkJCXdlaWdodE1zZ0JlZ2luUmVkZWxlZ2F0ZSwKCQkJU2ltdWxhdGVNc2dCZWdpblJlZGVsZWdhdGUoYWssIGJrLCBrKSwKCQkpLAoJfQp9CgovLyBTaW11bGF0ZU1zZ0NyZWF0ZVZhbGlkYXRvciBnZW5lcmF0ZXMgYSBNc2dDcmVhdGVWYWxpZGF0b3Igd2l0aCByYW5kb20gdmFsdWVzCi8vIG5vbGludDogaW50ZXJmYWNlcgpmdW5jIFNpbXVsYXRlTXNnQ3JlYXRlVmFsaWRhdG9yKGFrIHR5cGVzLkFjY291bnRLZWVwZXIsIGJrIHR5cGVzLkJhbmtLZWVwZXIsIGsga2VlcGVyLktlZXBlcikgc2ltdHlwZXMuT3BlcmF0aW9uIHsKCXJldHVybiBmdW5jKAoJCXIgKnJhbmQuUmFuZCwgYXBwICpiYXNlYXBwLkJhc2VBcHAsIGN0eCBzZGsuQ29udGV4dCwgYWNjcyBbXXNpbXR5cGVzLkFjY291bnQsIGNoYWluSUQgc3RyaW5nLAoJKSAoc2ltdHlwZXMuT3BlcmF0aW9uTXNnLCBbXXNpbXR5cGVzLkZ1dHVyZU9wZXJhdGlvbiwgZXJyb3IpIHsKCQlzaW1BY2NvdW50LCBfIDo9IHNpbXR5cGVzLlJhbmRvbUFjYyhyLCBhY2NzKQoJCWFkZHJlc3MgOj0gc2RrLlZhbEFkZHJlc3Moc2ltQWNjb3VudC5BZGRyZXNzKQoKCQkvLyBlbnN1cmUgdGhlIHZhbGlkYXRvciBkb2Vzbid0IGV4aXN0IGFscmVhZHkKCQlfLCBmb3VuZCA6PSBrLkdldFZhbGlkYXRvcihjdHgsIGFkZHJlc3MpCgkJaWYgZm91bmQgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnQ3JlYXRlVmFsaWRhdG9yLCAmcXVvdDt1bmFibGUgdG8gZmluZCB2YWxpZGF0b3ImcXVvdDspLCBuaWwsIG5pbAoJCX0KCgkJZGVub20gOj0gay5HZXRQYXJhbXMoY3R4KS5Cb25kRGVub20KCgkJYmFsYW5jZSA6PSBiay5HZXRCYWxhbmNlKGN0eCwgc2ltQWNjb3VudC5BZGRyZXNzLCBkZW5vbSkuQW1vdW50CgkJaWYgIWJhbGFuY2UuSXNQb3NpdGl2ZSgpIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ0NyZWF0ZVZhbGlkYXRvciwgJnF1b3Q7YmFsYW5jZSBpcyBuZWdhdGl2ZSZxdW90OyksIG5pbCwgbmlsCgkJfQoKCQlhbW91bnQsIGVyciA6PSBzaW10eXBlcy5SYW5kUG9zaXRpdmVJbnQociwgYmFsYW5jZSkKCQlpZiBlcnIgIT0gbmlsIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ0NyZWF0ZVZhbGlkYXRvciwgJnF1b3Q7dW5hYmxlIHRvIGdlbmVyYXRlIHBvc2l0aXZlIGFtb3VudCZxdW90OyksIG5pbCwgZXJyCgkJfQoKCQlzZWxmRGVsZWdhdGlvbiA6PSBzZGsuTmV3Q29pbihkZW5vbSwgYW1vdW50KQoKCQlhY2NvdW50IDo9IGFrLkdldEFjY291bnQoY3R4LCBzaW1BY2NvdW50LkFkZHJlc3MpCgkJc3BlbmRhYmxlIDo9IGJrLlNwZW5kYWJsZUNvaW5zKGN0eCwgYWNjb3VudC5HZXRBZGRyZXNzKCkpCgoJCXZhciBmZWVzIHNkay5Db2lucwoKCQljb2lucywgaGFzTmVnIDo9IHNwZW5kYWJsZS5TYWZlU3ViKHNkay5Db2luc3tzZWxmRGVsZWdhdGlvbn0pCgkJaWYgIWhhc05lZyB7CgkJCWZlZXMsIGVyciA9IHNpbXR5cGVzLlJhbmRvbUZlZXMociwgY3R4LCBjb2lucykKCQkJaWYgZXJyICE9IG5pbCB7CgkJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnQ3JlYXRlVmFsaWRhdG9yLCAmcXVvdDt1bmFibGUgdG8gZ2VuZXJhdGUgZmVlcyZxdW90OyksIG5pbCwgZXJyCgkJCX0KCQl9CgoJCWRlc2NyaXB0aW9uIDo9IHR5cGVzLk5ld0Rlc2NyaXB0aW9uKAoJCQlzaW10eXBlcy5SYW5kU3RyaW5nT2ZMZW5ndGgociwgMTApLAoJCQlzaW10eXBlcy5SYW5kU3RyaW5nT2ZMZW5ndGgociwgMTApLAoJCQlzaW10eXBlcy5SYW5kU3RyaW5nT2ZMZW5ndGgociwgMTApLAoJCQlzaW10eXBlcy5SYW5kU3RyaW5nT2ZMZW5ndGgociwgMTApLAoJCQlzaW10eXBlcy5SYW5kU3RyaW5nT2ZMZW5ndGgociwgMTApLAoJCSkKCgkJbWF4Q29tbWlzc2lvbiA6PSBzZGsuTmV3RGVjV2l0aFByZWMoaW50NjQoc2ltdHlwZXMuUmFuZEludEJldHdlZW4ociwgMCwgMTAwKSksIDIpCgkJY29tbWlzc2lvbiA6PSB0eXBlcy5OZXdDb21taXNzaW9uUmF0ZXMoCgkJCXNpbXR5cGVzLlJhbmRvbURlY0Ftb3VudChyLCBtYXhDb21taXNzaW9uKSwKCQkJbWF4Q29tbWlzc2lvbiwKCQkJc2ltdHlwZXMuUmFuZG9tRGVjQW1vdW50KHIsIG1heENvbW1pc3Npb24pLAoJCSkKCgkJbXNnLCBlcnIgOj0gdHlwZXMuTmV3TXNnQ3JlYXRlVmFsaWRhdG9yKGFkZHJlc3MsIHNpbUFjY291bnQuQ29uc0tleS5QdWJLZXkoKSwgc2VsZkRlbGVnYXRpb24sIGRlc2NyaXB0aW9uLCBjb21taXNzaW9uLCBzZGsuT25lSW50KCkpCgkJaWYgZXJyICE9IG5pbCB7CgkJCXJldHVybiBzaW10eXBlcy5Ob09wTXNnKHR5cGVzLk1vZHVsZU5hbWUsIG1zZy5UeXBlKCksICZxdW90O3VuYWJsZSB0byBjcmVhdGUgQ3JlYXRlVmFsaWRhdG9yIG1lc3NhZ2UmcXVvdDspLCBuaWwsIGVycgoJCX0KCgkJdHhHZW4gOj0gc2ltYXBwcGFyYW1zLk1ha2VUZXN0RW5jb2RpbmdDb25maWcoKS5UeENvbmZpZwoJCXR4LCBlcnIgOj0gaGVscGVycy5HZW5UeCgKCQkJdHhHZW4sCgkJCVtdc2RrLk1zZ3ttc2d9LAoJCQlmZWVzLAoJCQloZWxwZXJzLkRlZmF1bHRHZW5UeEdhcywKCQkJY2hhaW5JRCwKCQkJW111aW50NjR7YWNjb3VudC5HZXRBY2NvdW50TnVtYmVyKCl9LAoJCQlbXXVpbnQ2NHthY2NvdW50LkdldFNlcXVlbmNlKCl9LAoJCQlzaW1BY2NvdW50LlByaXZLZXksCgkJKQoJCWlmIGVyciAhPSBuaWwgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCBtc2cuVHlwZSgpLCAmcXVvdDt1bmFibGUgdG8gZ2VuZXJhdGUgbW9jayB0eCZxdW90OyksIG5pbCwgZXJyCgkJfQoKCQlfLCBfLCBlcnIgPSBhcHAuRGVsaXZlcih0eEdlbi5UeEVuY29kZXIoKSwgdHgpCgkJaWYgZXJyICE9IG5pbCB7CgkJCXJldHVybiBzaW10eXBlcy5Ob09wTXNnKHR5cGVzLk1vZHVsZU5hbWUsIG1zZy5UeXBlKCksICZxdW90O3VuYWJsZSB0byBkZWxpdmVyIHR4JnF1b3Q7KSwgbmlsLCBlcnIKCQl9CgoJCXJldHVybiBzaW10eXBlcy5OZXdPcGVyYXRpb25Nc2cobXNnLCB0cnVlLCAmcXVvdDsmcXVvdDssIG5pbCksIG5pbCwgbmlsCgl9Cn0KCi8vIFNpbXVsYXRlTXNnRWRpdFZhbGlkYXRvciBnZW5lcmF0ZXMgYSBNc2dFZGl0VmFsaWRhdG9yIHdpdGggcmFuZG9tIHZhbHVlcwovLyBub2xpbnQ6IGludGVyZmFjZXIKZnVuYyBTaW11bGF0ZU1zZ0VkaXRWYWxpZGF0b3IoYWsgdHlwZXMuQWNjb3VudEtlZXBlciwgYmsgdHlwZXMuQmFua0tlZXBlciwgayBrZWVwZXIuS2VlcGVyKSBzaW10eXBlcy5PcGVyYXRpb24gewoJcmV0dXJuIGZ1bmMoCgkJciAqcmFuZC5SYW5kLCBhcHAgKmJhc2VhcHAuQmFzZUFwcCwgY3R4IHNkay5Db250ZXh0LCBhY2NzIFtdc2ltdHlwZXMuQWNjb3VudCwgY2hhaW5JRCBzdHJpbmcsCgkpIChzaW10eXBlcy5PcGVyYXRpb25Nc2csIFtdc2ltdHlwZXMuRnV0dXJlT3BlcmF0aW9uLCBlcnJvcikgewoJCWlmIGxlbihrLkdldEFsbFZhbGlkYXRvcnMoY3R4KSkgPT0gMCB7CgkJCXJldHVybiBzaW10eXBlcy5Ob09wTXNnKHR5cGVzLk1vZHVsZU5hbWUsIHR5cGVzLlR5cGVNc2dFZGl0VmFsaWRhdG9yLCAmcXVvdDtudW1iZXIgb2YgdmFsaWRhdG9ycyBlcXVhbCB6ZXJvJnF1b3Q7KSwgbmlsLCBuaWwKCQl9CgoJCXZhbCwgb2sgOj0ga2VlcGVyLlJhbmRvbVZhbGlkYXRvcihyLCBrLCBjdHgpCgkJaWYgIW9rIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ0VkaXRWYWxpZGF0b3IsICZxdW90O3VuYWJsZSB0byBwaWNrIGEgdmFsaWRhdG9yJnF1b3Q7KSwgbmlsLCBuaWwKCQl9CgoJCWFkZHJlc3MgOj0gdmFsLkdldE9wZXJhdG9yKCkKCgkJbmV3Q29tbWlzc2lvblJhdGUgOj0gc2ltdHlwZXMuUmFuZG9tRGVjQW1vdW50KHIsIHZhbC5Db21taXNzaW9uLk1heFJhdGUpCgoJCWlmIGVyciA6PSB2YWwuQ29tbWlzc2lvbi5WYWxpZGF0ZU5ld1JhdGUobmV3Q29tbWlzc2lvblJhdGUsIGN0eC5CbG9ja0hlYWRlcigpLlRpbWUpOyBlcnIgIT0gbmlsIHsKCQkJLy8gc2tpcCBhcyB0aGUgY29tbWlzc2lvbiBpcyBpbnZhbGlkCgkJCXJldHVybiBzaW10eXBlcy5Ob09wTXNnKHR5cGVzLk1vZHVsZU5hbWUsIHR5cGVzLlR5cGVNc2dFZGl0VmFsaWRhdG9yLCAmcXVvdDtpbnZhbGlkIGNvbW1pc3Npb24gcmF0ZSZxdW90OyksIG5pbCwgbmlsCgkJfQoKCQlzaW1BY2NvdW50LCBmb3VuZCA6PSBzaW10eXBlcy5GaW5kQWNjb3VudChhY2NzLCBzZGsuQWNjQWRkcmVzcyh2YWwuR2V0T3BlcmF0b3IoKSkpCgkJaWYgIWZvdW5kIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ0VkaXRWYWxpZGF0b3IsICZxdW90O3VuYWJsZSB0byBmaW5kIGFjY291bnQmcXVvdDspLCBuaWwsIGZtdC5FcnJvcmYoJnF1b3Q7dmFsaWRhdG9yICVzIG5vdCBmb3VuZCZxdW90OywgdmFsLkdldE9wZXJhdG9yKCkpCgkJfQoKCQlhY2NvdW50IDo9IGFrLkdldEFjY291bnQoY3R4LCBzaW1BY2NvdW50LkFkZHJlc3MpCgkJc3BlbmRhYmxlIDo9IGJrLlNwZW5kYWJsZUNvaW5zKGN0eCwgYWNjb3VudC5HZXRBZGRyZXNzKCkpCgoJCWZlZXMsIGVyciA6PSBzaW10eXBlcy5SYW5kb21GZWVzKHIsIGN0eCwgc3BlbmRhYmxlKQoJCWlmIGVyciAhPSBuaWwgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnRWRpdFZhbGlkYXRvciwgJnF1b3Q7dW5hYmxlIHRvIGdlbmVyYXRlIGZlZXMmcXVvdDspLCBuaWwsIGVycgoJCX0KCgkJZGVzY3JpcHRpb24gOj0gdHlwZXMuTmV3RGVzY3JpcHRpb24oCgkJCXNpbXR5cGVzLlJhbmRTdHJpbmdPZkxlbmd0aChyLCAxMCksCgkJCXNpbXR5cGVzLlJhbmRTdHJpbmdPZkxlbmd0aChyLCAxMCksCgkJCXNpbXR5cGVzLlJhbmRTdHJpbmdPZkxlbmd0aChyLCAxMCksCgkJCXNpbXR5cGVzLlJhbmRTdHJpbmdPZkxlbmd0aChyLCAxMCksCgkJCXNpbXR5cGVzLlJhbmRTdHJpbmdPZkxlbmd0aChyLCAxMCksCgkJKQoKCQltc2cgOj0gdHlwZXMuTmV3TXNnRWRpdFZhbGlkYXRvcihhZGRyZXNzLCBkZXNjcmlwdGlvbiwgJmFtcDtuZXdDb21taXNzaW9uUmF0ZSwgbmlsKQoKCQl0eEdlbiA6PSBzaW1hcHBwYXJhbXMuTWFrZVRlc3RFbmNvZGluZ0NvbmZpZygpLlR4Q29uZmlnCgkJdHgsIGVyciA6PSBoZWxwZXJzLkdlblR4KAoJCQl0eEdlbiwKCQkJW11zZGsuTXNne21zZ30sCgkJCWZlZXMsCgkJCWhlbHBlcnMuRGVmYXVsdEdlblR4R2FzLAoJCQljaGFpbklELAoJCQlbXXVpbnQ2NHthY2NvdW50LkdldEFjY291bnROdW1iZXIoKX0sCgkJCVtddWludDY0e2FjY291bnQuR2V0U2VxdWVuY2UoKX0sCgkJCXNpbUFjY291bnQuUHJpdktleSwKCQkpCgkJaWYgZXJyICE9IG5pbCB7CgkJCXJldHVybiBzaW10eXBlcy5Ob09wTXNnKHR5cGVzLk1vZHVsZU5hbWUsIG1zZy5UeXBlKCksICZxdW90O3VuYWJsZSB0byBnZW5lcmF0ZSBtb2NrIHR4JnF1b3Q7KSwgbmlsLCBlcnIKCQl9CgoJCV8sIF8sIGVyciA9IGFwcC5EZWxpdmVyKHR4R2VuLlR4RW5jb2RlcigpLCB0eCkKCQlpZiBlcnIgIT0gbmlsIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgbXNnLlR5cGUoKSwgJnF1b3Q7dW5hYmxlIHRvIGRlbGl2ZXIgdHgmcXVvdDspLCBuaWwsIGVycgoJCX0KCgkJcmV0dXJuIHNpbXR5cGVzLk5ld09wZXJhdGlvbk1zZyhtc2csIHRydWUsICZxdW90OyZxdW90OywgbmlsKSwgbmlsLCBuaWwKCX0KfQoKLy8gU2ltdWxhdGVNc2dEZWxlZ2F0ZSBnZW5lcmF0ZXMgYSBNc2dEZWxlZ2F0ZSB3aXRoIHJhbmRvbSB2YWx1ZXMKLy8gbm9saW50OiBpbnRlcmZhY2VyCmZ1bmMgU2ltdWxhdGVNc2dEZWxlZ2F0ZShhayB0eXBlcy5BY2NvdW50S2VlcGVyLCBiayB0eXBlcy5CYW5rS2VlcGVyLCBrIGtlZXBlci5LZWVwZXIpIHNpbXR5cGVzLk9wZXJhdGlvbiB7CglyZXR1cm4gZnVuYygKCQlyICpyYW5kLlJhbmQsIGFwcCAqYmFzZWFwcC5CYXNlQXBwLCBjdHggc2RrLkNvbnRleHQsIGFjY3MgW11zaW10eXBlcy5BY2NvdW50LCBjaGFpbklEIHN0cmluZywKCSkgKHNpbXR5cGVzLk9wZXJhdGlvbk1zZywgW11zaW10eXBlcy5GdXR1cmVPcGVyYXRpb24sIGVycm9yKSB7CgkJZGVub20gOj0gay5HZXRQYXJhbXMoY3R4KS5Cb25kRGVub20KCgkJaWYgbGVuKGsuR2V0QWxsVmFsaWRhdG9ycyhjdHgpKSA9PSAwIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ0RlbGVnYXRlLCAmcXVvdDtudW1iZXIgb2YgdmFsaWRhdG9ycyBlcXVhbCB6ZXJvJnF1b3Q7KSwgbmlsLCBuaWwKCQl9CgoJCXNpbUFjY291bnQsIF8gOj0gc2ltdHlwZXMuUmFuZG9tQWNjKHIsIGFjY3MpCgkJdmFsLCBvayA6PSBrZWVwZXIuUmFuZG9tVmFsaWRhdG9yKHIsIGssIGN0eCkKCQlpZiAhb2sgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnRGVsZWdhdGUsICZxdW90O3VuYWJsZSB0byBwaWNrIGEgdmFsaWRhdG9yJnF1b3Q7KSwgbmlsLCBuaWwKCQl9CgoJCWlmIHZhbC5JbnZhbGlkRXhSYXRlKCkgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnRGVsZWdhdGUsICZxdW90O3ZhbGlkYXRvcidzIGludmFsaWQgZWNoYW5nZSByYXRlJnF1b3Q7KSwgbmlsLCBuaWwKCQl9CgoJCWFtb3VudCA6PSBiay5HZXRCYWxhbmNlKGN0eCwgc2ltQWNjb3VudC5BZGRyZXNzLCBkZW5vbSkuQW1vdW50CgkJaWYgIWFtb3VudC5Jc1Bvc2l0aXZlKCkgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnRGVsZWdhdGUsICZxdW90O2JhbGFuY2UgaXMgbmVnYXRpdmUmcXVvdDspLCBuaWwsIG5pbAoJCX0KCgkJYW1vdW50LCBlcnIgOj0gc2ltdHlwZXMuUmFuZFBvc2l0aXZlSW50KHIsIGFtb3VudCkKCQlpZiBlcnIgIT0gbmlsIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ0RlbGVnYXRlLCAmcXVvdDt1bmFibGUgdG8gZ2VuZXJhdGUgcG9zaXRpdmUgYW1vdW50JnF1b3Q7KSwgbmlsLCBlcnIKCQl9CgoJCWJvbmRBbXQgOj0gc2RrLk5ld0NvaW4oZGVub20sIGFtb3VudCkKCgkJYWNjb3VudCA6PSBhay5HZXRBY2NvdW50KGN0eCwgc2ltQWNjb3VudC5BZGRyZXNzKQoJCXNwZW5kYWJsZSA6PSBiay5TcGVuZGFibGVDb2lucyhjdHgsIGFjY291bnQuR2V0QWRkcmVzcygpKQoKCQl2YXIgZmVlcyBzZGsuQ29pbnMKCgkJY29pbnMsIGhhc05lZyA6PSBzcGVuZGFibGUuU2FmZVN1YihzZGsuQ29pbnN7Ym9uZEFtdH0pCgkJaWYgIWhhc05lZyB7CgkJCWZlZXMsIGVyciA9IHNpbXR5cGVzLlJhbmRvbUZlZXMociwgY3R4LCBjb2lucykKCQkJaWYgZXJyICE9IG5pbCB7CgkJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnRGVsZWdhdGUsICZxdW90O3VuYWJsZSB0byBnZW5lcmF0ZSBmZWVzJnF1b3Q7KSwgbmlsLCBlcnIKCQkJfQoJCX0KCgkJbXNnIDo9IHR5cGVzLk5ld01zZ0RlbGVnYXRlKHNpbUFjY291bnQuQWRkcmVzcywgdmFsLkdldE9wZXJhdG9yKCksIGJvbmRBbXQpCgoJCXR4R2VuIDo9IHNpbWFwcHBhcmFtcy5NYWtlVGVzdEVuY29kaW5nQ29uZmlnKCkuVHhDb25maWcKCQl0eCwgZXJyIDo9IGhlbHBlcnMuR2VuVHgoCgkJCXR4R2VuLAoJCQlbXXNkay5Nc2d7bXNnfSwKCQkJZmVlcywKCQkJaGVscGVycy5EZWZhdWx0R2VuVHhHYXMsCgkJCWNoYWluSUQsCgkJCVtddWludDY0e2FjY291bnQuR2V0QWNjb3VudE51bWJlcigpfSwKCQkJW111aW50NjR7YWNjb3VudC5HZXRTZXF1ZW5jZSgpfSwKCQkJc2ltQWNjb3VudC5Qcml2S2V5LAoJCSkKCQlpZiBlcnIgIT0gbmlsIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgbXNnLlR5cGUoKSwgJnF1b3Q7dW5hYmxlIHRvIGdlbmVyYXRlIG1vY2sgdHgmcXVvdDspLCBuaWwsIGVycgoJCX0KCgkJXywgXywgZXJyID0gYXBwLkRlbGl2ZXIodHhHZW4uVHhFbmNvZGVyKCksIHR4KQoJCWlmIGVyciAhPSBuaWwgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCBtc2cuVHlwZSgpLCAmcXVvdDt1bmFibGUgdG8gZGVsaXZlciB0eCZxdW90OyksIG5pbCwgZXJyCgkJfQoKCQlyZXR1cm4gc2ltdHlwZXMuTmV3T3BlcmF0aW9uTXNnKG1zZywgdHJ1ZSwgJnF1b3Q7JnF1b3Q7LCBuaWwpLCBuaWwsIG5pbAoJfQp9CgovLyBTaW11bGF0ZU1zZ1VuZGVsZWdhdGUgZ2VuZXJhdGVzIGEgTXNnVW5kZWxlZ2F0ZSB3aXRoIHJhbmRvbSB2YWx1ZXMKLy8gbm9saW50OiBpbnRlcmZhY2VyCmZ1bmMgU2ltdWxhdGVNc2dVbmRlbGVnYXRlKGFrIHR5cGVzLkFjY291bnRLZWVwZXIsIGJrIHR5cGVzLkJhbmtLZWVwZXIsIGsga2VlcGVyLktlZXBlcikgc2ltdHlwZXMuT3BlcmF0aW9uIHsKCXJldHVybiBmdW5jKAoJCXIgKnJhbmQuUmFuZCwgYXBwICpiYXNlYXBwLkJhc2VBcHAsIGN0eCBzZGsuQ29udGV4dCwgYWNjcyBbXXNpbXR5cGVzLkFjY291bnQsIGNoYWluSUQgc3RyaW5nLAoJKSAoc2ltdHlwZXMuT3BlcmF0aW9uTXNnLCBbXXNpbXR5cGVzLkZ1dHVyZU9wZXJhdGlvbiwgZXJyb3IpIHsKCQkvLyBnZXQgcmFuZG9tIHZhbGlkYXRvcgoJCXZhbGlkYXRvciwgb2sgOj0ga2VlcGVyLlJhbmRvbVZhbGlkYXRvcihyLCBrLCBjdHgpCgkJaWYgIW9rIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ1VuZGVsZWdhdGUsICZxdW90O3ZhbGlkYXRvciBpcyBub3Qgb2smcXVvdDspLCBuaWwsIG5pbAoJCX0KCgkJdmFsQWRkciA6PSB2YWxpZGF0b3IuR2V0T3BlcmF0b3IoKQoJCWRlbGVnYXRpb25zIDo9IGsuR2V0VmFsaWRhdG9yRGVsZWdhdGlvbnMoY3R4LCB2YWxpZGF0b3IuR2V0T3BlcmF0b3IoKSkKCQlpZiBkZWxlZ2F0aW9ucyA9PSBuaWwgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnVW5kZWxlZ2F0ZSwgJnF1b3Q7a2VlcGVyIGRvZXMgaGF2ZSBhbnkgZGVsZWdhdGlvbiBlbnRyaWVzJnF1b3Q7KSwgbmlsLCBuaWwKCQl9CgoJCS8vIGdldCByYW5kb20gZGVsZWdhdG9yIGZyb20gdmFsaWRhdG9yCgkJZGVsZWdhdGlvbiA6PSBkZWxlZ2F0aW9uc1tyLkludG4obGVuKGRlbGVnYXRpb25zKSldCgkJZGVsQWRkciA6PSBkZWxlZ2F0aW9uLkdldERlbGVnYXRvckFkZHIoKQoKCQlpZiBrLkhhc01heFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyaWVzKGN0eCwgZGVsQWRkciwgdmFsQWRkcikgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnVW5kZWxlZ2F0ZSwgJnF1b3Q7a2VlcGVyIGRvZXMgaGF2ZSBhIG1heCB1bmJvbmRpbmcgZGVsZWdhdGlvbiBlbnRyaWVzJnF1b3Q7KSwgbmlsLCBuaWwKCQl9CgoJCXRvdGFsQm9uZCA6PSB2YWxpZGF0b3IuVG9rZW5zRnJvbVNoYXJlcyhkZWxlZ2F0aW9uLkdldFNoYXJlcygpKS5UcnVuY2F0ZUludCgpCgkJaWYgIXRvdGFsQm9uZC5Jc1Bvc2l0aXZlKCkgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnVW5kZWxlZ2F0ZSwgJnF1b3Q7dG90YWwgYm9uZCBpcyBuZWdhdGl2ZSZxdW90OyksIG5pbCwgbmlsCgkJfQoKCQl1bmJvbmRBbXQsIGVyciA6PSBzaW10eXBlcy5SYW5kUG9zaXRpdmVJbnQociwgdG90YWxCb25kKQoJCWlmIGVyciAhPSBuaWwgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnVW5kZWxlZ2F0ZSwgJnF1b3Q7aW52YWxpZCB1bmJvbmQgYW1vdW50JnF1b3Q7KSwgbmlsLCBlcnIKCQl9CgoJCWlmIHVuYm9uZEFtdC5Jc1plcm8oKSB7CgkJCXJldHVybiBzaW10eXBlcy5Ob09wTXNnKHR5cGVzLk1vZHVsZU5hbWUsIHR5cGVzLlR5cGVNc2dVbmRlbGVnYXRlLCAmcXVvdDt1bmJvbmQgYW1vdW50IGlzIHplcm8mcXVvdDspLCBuaWwsIG5pbAoJCX0KCgkJbXNnIDo9IHR5cGVzLk5ld01zZ1VuZGVsZWdhdGUoCgkJCWRlbEFkZHIsIHZhbEFkZHIsIHNkay5OZXdDb2luKGsuQm9uZERlbm9tKGN0eCksIHVuYm9uZEFtdCksCgkJKQoKCQkvLyBuZWVkIHRvIHJldHJpZXZlIHRoZSBzaW11bGF0aW9uIGFjY291bnQgYXNzb2NpYXRlZCB3aXRoIGRlbGVnYXRpb24gdG8gcmV0cmlldmUgUHJpdktleQoJCXZhciBzaW1BY2NvdW50IHNpbXR5cGVzLkFjY291bnQKCgkJZm9yIF8sIHNpbUFjYyA6PSByYW5nZSBhY2NzIHsKCQkJaWYgc2ltQWNjLkFkZHJlc3MuRXF1YWxzKGRlbEFkZHIpIHsKCQkJCXNpbUFjY291bnQgPSBzaW1BY2MKCQkJCWJyZWFrCgkJCX0KCQl9CgkJLy8gaWYgc2ltYWNjb3VudC5Qcml2S2V5ID09IG5pbCwgZGVsZWdhdGlvbiBhZGRyZXNzIGRvZXMgbm90IGV4aXN0IGluIGFjY3MuIFJldHVybiBlcnJvcgoJCWlmIHNpbUFjY291bnQuUHJpdktleSA9PSBuaWwgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCBtc2cuVHlwZSgpLCAmcXVvdDthY2NvdW50IHByaXZhdGUga2V5IGlzIG5pbCZxdW90OyksIG5pbCwgZm10LkVycm9yZigmcXVvdDtkZWxlZ2F0aW9uIGFkZHI6ICVzIGRvZXMgbm90IGV4aXN0IGluIHNpbXVsYXRpb24gYWNjb3VudHMmcXVvdDssIGRlbEFkZHIpCgkJfQoKCQlhY2NvdW50IDo9IGFrLkdldEFjY291bnQoY3R4LCBkZWxBZGRyKQoJCXNwZW5kYWJsZSA6PSBiay5TcGVuZGFibGVDb2lucyhjdHgsIGFjY291bnQuR2V0QWRkcmVzcygpKQoKCQlmZWVzLCBlcnIgOj0gc2ltdHlwZXMuUmFuZG9tRmVlcyhyLCBjdHgsIHNwZW5kYWJsZSkKCQlpZiBlcnIgIT0gbmlsIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgbXNnLlR5cGUoKSwgJnF1b3Q7dW5hYmxlIHRvIGdlbmVyYXRlIGZlZXMmcXVvdDspLCBuaWwsIGVycgoJCX0KCgkJdHhHZW4gOj0gc2ltYXBwcGFyYW1zLk1ha2VUZXN0RW5jb2RpbmdDb25maWcoKS5UeENvbmZpZwoJCXR4LCBlcnIgOj0gaGVscGVycy5HZW5UeCgKCQkJdHhHZW4sCgkJCVtdc2RrLk1zZ3ttc2d9LAoJCQlmZWVzLAoJCQloZWxwZXJzLkRlZmF1bHRHZW5UeEdhcywKCQkJY2hhaW5JRCwKCQkJW111aW50NjR7YWNjb3VudC5HZXRBY2NvdW50TnVtYmVyKCl9LAoJCQlbXXVpbnQ2NHthY2NvdW50LkdldFNlcXVlbmNlKCl9LAoJCQlzaW1BY2NvdW50LlByaXZLZXksCgkJKQoJCWlmIGVyciAhPSBuaWwgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCBtc2cuVHlwZSgpLCAmcXVvdDt1bmFibGUgdG8gZ2VuZXJhdGUgbW9jayB0eCZxdW90OyksIG5pbCwgZXJyCgkJfQoKCQlfLCBfLCBlcnIgPSBhcHAuRGVsaXZlcih0eEdlbi5UeEVuY29kZXIoKSwgdHgpCgkJaWYgZXJyICE9IG5pbCB7CgkJCXJldHVybiBzaW10eXBlcy5Ob09wTXNnKHR5cGVzLk1vZHVsZU5hbWUsIG1zZy5UeXBlKCksICZxdW90O3VuYWJsZSB0byBkZWxpdmVyIHR4JnF1b3Q7KSwgbmlsLCBlcnIKCQl9CgoJCXJldHVybiBzaW10eXBlcy5OZXdPcGVyYXRpb25Nc2cobXNnLCB0cnVlLCAmcXVvdDsmcXVvdDssIG5pbCksIG5pbCwgbmlsCgl9Cn0KCi8vIFNpbXVsYXRlTXNnQmVnaW5SZWRlbGVnYXRlIGdlbmVyYXRlcyBhIE1zZ0JlZ2luUmVkZWxlZ2F0ZSB3aXRoIHJhbmRvbSB2YWx1ZXMKLy8gbm9saW50OiBpbnRlcmZhY2VyCmZ1bmMgU2ltdWxhdGVNc2dCZWdpblJlZGVsZWdhdGUoYWsgdHlwZXMuQWNjb3VudEtlZXBlciwgYmsgdHlwZXMuQmFua0tlZXBlciwgayBrZWVwZXIuS2VlcGVyKSBzaW10eXBlcy5PcGVyYXRpb24gewoJcmV0dXJuIGZ1bmMoCgkJciAqcmFuZC5SYW5kLCBhcHAgKmJhc2VhcHAuQmFzZUFwcCwgY3R4IHNkay5Db250ZXh0LCBhY2NzIFtdc2ltdHlwZXMuQWNjb3VudCwgY2hhaW5JRCBzdHJpbmcsCgkpIChzaW10eXBlcy5PcGVyYXRpb25Nc2csIFtdc2ltdHlwZXMuRnV0dXJlT3BlcmF0aW9uLCBlcnJvcikgewoJCS8vIGdldCByYW5kb20gc291cmNlIHZhbGlkYXRvcgoJCXNyY1ZhbCwgb2sgOj0ga2VlcGVyLlJhbmRvbVZhbGlkYXRvcihyLCBrLCBjdHgpCgkJaWYgIW9rIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ0JlZ2luUmVkZWxlZ2F0ZSwgJnF1b3Q7dW5hYmxlIHRvIHBpY2sgdmFsaWRhdG9yJnF1b3Q7KSwgbmlsLCBuaWwKCQl9CgoJCXNyY0FkZHIgOj0gc3JjVmFsLkdldE9wZXJhdG9yKCkKCQlkZWxlZ2F0aW9ucyA6PSBrLkdldFZhbGlkYXRvckRlbGVnYXRpb25zKGN0eCwgc3JjQWRkcikKCQlpZiBkZWxlZ2F0aW9ucyA9PSBuaWwgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnQmVnaW5SZWRlbGVnYXRlLCAmcXVvdDtrZWVwZXIgZG9lcyBoYXZlIGFueSBkZWxlZ2F0aW9uIGVudHJpZXMmcXVvdDspLCBuaWwsIG5pbAoJCX0KCgkJLy8gZ2V0IHJhbmRvbSBkZWxlZ2F0b3IgZnJvbSBzcmMgdmFsaWRhdG9yCgkJZGVsZWdhdGlvbiA6PSBkZWxlZ2F0aW9uc1tyLkludG4obGVuKGRlbGVnYXRpb25zKSldCgkJZGVsQWRkciA6PSBkZWxlZ2F0aW9uLkdldERlbGVnYXRvckFkZHIoKQoKCQlpZiBrLkhhc1JlY2VpdmluZ1JlZGVsZWdhdGlvbihjdHgsIGRlbEFkZHIsIHNyY0FkZHIpIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ0JlZ2luUmVkZWxlZ2F0ZSwgJnF1b3Q7cmVjZXZlaW5nIHJlZGVsZWdhdGlvbiBpcyBub3QgYWxsb3dlZCZxdW90OyksIG5pbCwgbmlsIC8vIHNraXAKCQl9CgoJCS8vIGdldCByYW5kb20gZGVzdGluYXRpb24gdmFsaWRhdG9yCgkJZGVzdFZhbCwgb2sgOj0ga2VlcGVyLlJhbmRvbVZhbGlkYXRvcihyLCBrLCBjdHgpCgkJaWYgIW9rIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ0JlZ2luUmVkZWxlZ2F0ZSwgJnF1b3Q7dW5hYmxlIHRvIHBpY2sgdmFsaWRhdG9yJnF1b3Q7KSwgbmlsLCBuaWwKCQl9CgoJCWRlc3RBZGRyIDo9IGRlc3RWYWwuR2V0T3BlcmF0b3IoKQoJCWlmIHNyY0FkZHIuRXF1YWxzKGRlc3RBZGRyKSB8fCBkZXN0VmFsLkludmFsaWRFeFJhdGUoKSB8fCBrLkhhc01heFJlZGVsZWdhdGlvbkVudHJpZXMoY3R4LCBkZWxBZGRyLCBzcmNBZGRyLCBkZXN0QWRkcikgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnQmVnaW5SZWRlbGVnYXRlLCAmcXVvdDtjaGVja3MgZmFpbGVkJnF1b3Q7KSwgbmlsLCBuaWwKCQl9CgoJCXRvdGFsQm9uZCA6PSBzcmNWYWwuVG9rZW5zRnJvbVNoYXJlcyhkZWxlZ2F0aW9uLkdldFNoYXJlcygpKS5UcnVuY2F0ZUludCgpCgkJaWYgIXRvdGFsQm9uZC5Jc1Bvc2l0aXZlKCkgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnQmVnaW5SZWRlbGVnYXRlLCAmcXVvdDt0b3RhbCBib25kIGlzIG5lZ2F0aXZlJnF1b3Q7KSwgbmlsLCBuaWwKCQl9CgoJCXJlZEFtdCwgZXJyIDo9IHNpbXR5cGVzLlJhbmRQb3NpdGl2ZUludChyLCB0b3RhbEJvbmQpCgkJaWYgZXJyICE9IG5pbCB7CgkJCXJldHVybiBzaW10eXBlcy5Ob09wTXNnKHR5cGVzLk1vZHVsZU5hbWUsIHR5cGVzLlR5cGVNc2dCZWdpblJlZGVsZWdhdGUsICZxdW90O3VuYWJsZSB0byBnZW5lcmF0ZSBwb3NpdGl2ZSBhbW91bnQmcXVvdDspLCBuaWwsIGVycgoJCX0KCgkJaWYgcmVkQW10LklzWmVybygpIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ0JlZ2luUmVkZWxlZ2F0ZSwgJnF1b3Q7YW1vdW50IGlzIHplcm8mcXVvdDspLCBuaWwsIG5pbAoJCX0KCgkJLy8gY2hlY2sgaWYgdGhlIHNoYXJlcyB0cnVuY2F0ZSB0byB6ZXJvCgkJc2hhcmVzLCBlcnIgOj0gc3JjVmFsLlNoYXJlc0Zyb21Ub2tlbnMocmVkQW10KQoJCWlmIGVyciAhPSBuaWwgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnQmVnaW5SZWRlbGVnYXRlLCAmcXVvdDtpbnZhbGlkIHNoYXJlcyZxdW90OyksIG5pbCwgZXJyCgkJfQoKCQlpZiBzcmNWYWwuVG9rZW5zRnJvbVNoYXJlcyhzaGFyZXMpLlRydW5jYXRlSW50KCkuSXNaZXJvKCkgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnQmVnaW5SZWRlbGVnYXRlLCAmcXVvdDtzaGFyZXMgdHJ1bmNhdGUgdG8gemVybyZxdW90OyksIG5pbCwgbmlsIC8vIHNraXAKCQl9CgoJCS8vIG5lZWQgdG8gcmV0cmlldmUgdGhlIHNpbXVsYXRpb24gYWNjb3VudCBhc3NvY2lhdGVkIHdpdGggZGVsZWdhdGlvbiB0byByZXRyaWV2ZSBQcml2S2V5CgkJdmFyIHNpbUFjY291bnQgc2ltdHlwZXMuQWNjb3VudAoKCQlmb3IgXywgc2ltQWNjIDo9IHJhbmdlIGFjY3MgewoJCQlpZiBzaW1BY2MuQWRkcmVzcy5FcXVhbHMoZGVsQWRkcikgewoJCQkJc2ltQWNjb3VudCA9IHNpbUFjYwoJCQkJYnJlYWsKCQkJfQoJCX0KCgkJLy8gaWYgc2ltYWNjb3VudC5Qcml2S2V5ID09IG5pbCwgZGVsZWdhdGlvbiBhZGRyZXNzIGRvZXMgbm90IGV4aXN0IGluIGFjY3MuIFJldHVybiBlcnJvcgoJCWlmIHNpbUFjY291bnQuUHJpdktleSA9PSBuaWwgewoJCQlyZXR1cm4gc2ltdHlwZXMuTm9PcE1zZyh0eXBlcy5Nb2R1bGVOYW1lLCB0eXBlcy5UeXBlTXNnQmVnaW5SZWRlbGVnYXRlLCAmcXVvdDthY2NvdW50IHByaXZhdGUga2V5IGlzIG5pbCZxdW90OyksIG5pbCwgZm10LkVycm9yZigmcXVvdDtkZWxlZ2F0aW9uIGFkZHI6ICVzIGRvZXMgbm90IGV4aXN0IGluIHNpbXVsYXRpb24gYWNjb3VudHMmcXVvdDssIGRlbEFkZHIpCgkJfQoKCQlhY2NvdW50IDo9IGFrLkdldEFjY291bnQoY3R4LCBkZWxBZGRyKQoJCXNwZW5kYWJsZSA6PSBiay5TcGVuZGFibGVDb2lucyhjdHgsIGFjY291bnQuR2V0QWRkcmVzcygpKQoKCQlmZWVzLCBlcnIgOj0gc2ltdHlwZXMuUmFuZG9tRmVlcyhyLCBjdHgsIHNwZW5kYWJsZSkKCQlpZiBlcnIgIT0gbmlsIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgdHlwZXMuVHlwZU1zZ0JlZ2luUmVkZWxlZ2F0ZSwgJnF1b3Q7dW5hYmxlIHRvIGdlbmVyYXRlIGZlZXMmcXVvdDspLCBuaWwsIGVycgoJCX0KCgkJbXNnIDo9IHR5cGVzLk5ld01zZ0JlZ2luUmVkZWxlZ2F0ZSgKCQkJZGVsQWRkciwgc3JjQWRkciwgZGVzdEFkZHIsCgkJCXNkay5OZXdDb2luKGsuQm9uZERlbm9tKGN0eCksIHJlZEFtdCksCgkJKQoKCQl0eEdlbiA6PSBzaW1hcHBwYXJhbXMuTWFrZVRlc3RFbmNvZGluZ0NvbmZpZygpLlR4Q29uZmlnCgkJdHgsIGVyciA6PSBoZWxwZXJzLkdlblR4KAoJCQl0eEdlbiwKCQkJW11zZGsuTXNne21zZ30sCgkJCWZlZXMsCgkJCWhlbHBlcnMuRGVmYXVsdEdlblR4R2FzLAoJCQljaGFpbklELAoJCQlbXXVpbnQ2NHthY2NvdW50LkdldEFjY291bnROdW1iZXIoKX0sCgkJCVtddWludDY0e2FjY291bnQuR2V0U2VxdWVuY2UoKX0sCgkJCXNpbUFjY291bnQuUHJpdktleSwKCQkpCgkJaWYgZXJyICE9IG5pbCB7CgkJCXJldHVybiBzaW10eXBlcy5Ob09wTXNnKHR5cGVzLk1vZHVsZU5hbWUsIG1zZy5UeXBlKCksICZxdW90O3VuYWJsZSB0byBnZW5lcmF0ZSBtb2NrIHR4JnF1b3Q7KSwgbmlsLCBlcnIKCQl9CgoJCV8sIF8sIGVyciA9IGFwcC5EZWxpdmVyKHR4R2VuLlR4RW5jb2RlcigpLCB0eCkKCQlpZiBlcnIgIT0gbmlsIHsKCQkJcmV0dXJuIHNpbXR5cGVzLk5vT3BNc2codHlwZXMuTW9kdWxlTmFtZSwgbXNnLlR5cGUoKSwgJnF1b3Q7dW5hYmxlIHRvIGRlbGl2ZXIgdHgmcXVvdDspLCBuaWwsIGVycgoJCX0KCgkJcmV0dXJuIHNpbXR5cGVzLk5ld09wZXJhdGlvbk1zZyhtc2csIHRydWUsICZxdW90OyZxdW90OywgbmlsKSwgbmlsLCBuaWwKCX0KfQo="}})],1),l._v(" "),d("p",[l._v("As you can see the weights are predefined in this case but there are options on how to override this behavior with different weights. One is allowing "),d("code",[l._v("*rand.Rand")]),l._v(" to define a random weight for the operation, or you can inject your own predefined weights.")]),l._v(" "),d("p",[l._v("Here is how one can override the above package "),d("code",[l._v("simappparams")]),l._v(".")]),l._v(" "),d("p",[d("tm-code-block",{staticClass:"codeblock",attrs:{language:"false",base64:"dGVzdC1zaW0tbm9uZGV0ZXJtaW5pc206CglAZWNobyAmcXVvdDtSdW5uaW5nIG5vbi1kZXRlcm1pbmlzbSB0ZXN0Li4uJnF1b3Q7CglAZ28gdGVzdCAtbW9kPXJlYWRvbmx5ICQoU0lNQVBQKSAtcnVuIFRlc3RBcHBTdGF0ZURldGVybWluaXNtIC1FbmFibGVkPXRydWUgXAoJCS1OdW1CbG9ja3M9MTAwIC1CbG9ja1NpemU9MjAwIC1Db21taXQ9dHJ1ZSAtUGVyaW9kPTAgLXYgLXRpbWVvdXQgMjRoCgp0ZXN0LXNpbS1jdXN0b20tZ2VuZXNpcy1mYXN0OgoJQGVjaG8gJnF1b3Q7UnVubmluZyBjdXN0b20gZ2VuZXNpcyBzaW11bGF0aW9uLi4uJnF1b3Q7CglAZWNobyAmcXVvdDtCeSBkZWZhdWx0LCAke0hPTUV9Ly5nYWlhZC9jb25maWcvZ2VuZXNpcy5qc29uIHdpbGwgYmUgdXNlZC4mcXVvdDsKCUBnbyB0ZXN0IC1tb2Q9cmVhZG9ubHkgJChTSU1BUFApIC1ydW4gVGVzdEZ1bGxHYWlhU2ltdWxhdGlvbiAtR2VuZXNpcz0ke0hPTUV9Ly5nYWlhZC9jb25maWcvZ2VuZXNpcy5qc29uIFwKCQktRW5hYmxlZD10cnVlIC1OdW1CbG9ja3M9MTAwIC1CbG9ja1NpemU9MjAwIC1Db21taXQ9dHJ1ZSAtU2VlZD05OSAtUGVyaW9kPTUgLXYgLXRpbWVvdXQgMjRoCgp0ZXN0LXNpbS1pbXBvcnQtZXhwb3J0OiBydW5zaW0KCUBlY2hvICZxdW90O1J1bm5pbmcgR2FpYSBpbXBvcnQvZXhwb3J0IHNpbXVsYXRpb24uIFRoaXMgbWF5IHRha2Ugc2V2ZXJhbCBtaW51dGVzLi4uJnF1b3Q7CglAJChCSU5ESVIpL3J1bnNpbSAtSm9icz00IC1TaW1BcHBQa2c9JChTSU1BUFApIDI1IDUgVGVzdEdhaWFJbXBvcnRFeHBvcnQ="}})],1),l._v(" "),d("p",[l._v("For the last test a tool called runsim  "),l._v(" is used, this is used to parallelize go test instances, provide info to Github and slack integrations to provide information to your team on how the simulations are running.")]),l._v(" "),d("h3",{attrs:{id:"random-proposal-contents"}},[d("a",{staticClass:"header-anchor",attrs:{href:"#random-proposal-contents"}},[l._v("#")]),l._v(" Random proposal contents")]),l._v(" "),d("p",[l._v("Randomized governance proposals are also supported on the SDK simulator. Each\nmodule must define the governance proposal "),d("code",[l._v("Content")]),l._v("s that they expose and register\nthem to be used on the parameters.")]),l._v(" "),d("h2",{attrs:{id:"registering-simulation-functions"}},[d("a",{staticClass:"header-anchor",attrs:{href:"#registering-simulation-functions"}},[l._v("#")]),l._v(" Registering simulation functions")]),l._v(" "),d("p",[l._v("Now that all the required functions are defined, we need to integrate them into the module pattern within the "),d("code",[l._v("module.go")]),l._v(":")]),l._v(" "),d("p",[d("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cGFja2FnZSBkaXN0cmlidXRpb24KCmltcG9ydCAoCgkmcXVvdDtjb250ZXh0JnF1b3Q7CgkmcXVvdDtlbmNvZGluZy9qc29uJnF1b3Q7CgkmcXVvdDtmbXQmcXVvdDsKCSZxdW90O21hdGgvcmFuZCZxdW90OwoKCSZxdW90O2dpdGh1Yi5jb20vZ3JwYy1lY29zeXN0ZW0vZ3JwYy1nYXRld2F5L3J1bnRpbWUmcXVvdDsKCgkmcXVvdDtnaXRodWIuY29tL2dvcmlsbGEvbXV4JnF1b3Q7CgkmcXVvdDtnaXRodWIuY29tL3NwZjEzL2NvYnJhJnF1b3Q7CglhYmNpICZxdW90O2dpdGh1Yi5jb20vdGVuZGVybWludC90ZW5kZXJtaW50L2FiY2kvdHlwZXMmcXVvdDsKCglzZGtjbGllbnQgJnF1b3Q7Z2l0aHViLmNvbS9jb3Ntb3MvY29zbW9zLXNkay9jbGllbnQmcXVvdDsKCSZxdW90O2dpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsvY29kZWMmcXVvdDsKCWNkY3R5cGVzICZxdW90O2dpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsvY29kZWMvdHlwZXMmcXVvdDsKCXNkayAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzJnF1b3Q7CgkmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzL21vZHVsZSZxdW90OwoJc2ltdHlwZXMgJnF1b3Q7Z2l0aHViLmNvbS9jb3Ntb3MvY29zbW9zLXNkay90eXBlcy9zaW11bGF0aW9uJnF1b3Q7CgkmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3gvZGlzdHJpYnV0aW9uL2NsaWVudC9jbGkmcXVvdDsKCSZxdW90O2dpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsveC9kaXN0cmlidXRpb24vY2xpZW50L3Jlc3QmcXVvdDsKCSZxdW90O2dpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsveC9kaXN0cmlidXRpb24va2VlcGVyJnF1b3Q7CgkmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3gvZGlzdHJpYnV0aW9uL3NpbXVsYXRpb24mcXVvdDsKCSZxdW90O2dpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsveC9kaXN0cmlidXRpb24vdHlwZXMmcXVvdDsKCXN0YWtpbmdrZWVwZXIgJnF1b3Q7Z2l0aHViLmNvbS9jb3Ntb3MvY29zbW9zLXNkay94L3N0YWtpbmcva2VlcGVyJnF1b3Q7CikKCnZhciAoCglfIG1vZHVsZS5BcHBNb2R1bGUgICAgICAgICAgID0gQXBwTW9kdWxle30KCV8gbW9kdWxlLkFwcE1vZHVsZUJhc2ljICAgICAgPSBBcHBNb2R1bGVCYXNpY3t9CglfIG1vZHVsZS5BcHBNb2R1bGVTaW11bGF0aW9uID0gQXBwTW9kdWxle30KKQoKLy8gQXBwTW9kdWxlQmFzaWMgZGVmaW5lcyB0aGUgYmFzaWMgYXBwbGljYXRpb24gbW9kdWxlIHVzZWQgYnkgdGhlIGRpc3RyaWJ1dGlvbiBtb2R1bGUuCnR5cGUgQXBwTW9kdWxlQmFzaWMgc3RydWN0IHsKCWNkYyBjb2RlYy5NYXJzaGFsZXIKfQoKLy8gTmFtZSByZXR1cm5zIHRoZSBkaXN0cmlidXRpb24gbW9kdWxlJ3MgbmFtZS4KZnVuYyAoQXBwTW9kdWxlQmFzaWMpIE5hbWUoKSBzdHJpbmcgewoJcmV0dXJuIHR5cGVzLk1vZHVsZU5hbWUKfQoKLy8gUmVnaXN0ZXJMZWdhY3lBbWlub0NvZGVjIHJlZ2lzdGVycyB0aGUgZGlzdHJpYnV0aW9uIG1vZHVsZSdzIHR5cGVzIGZvciB0aGUgZ2l2ZW4gY29kZWMuCmZ1bmMgKEFwcE1vZHVsZUJhc2ljKSBSZWdpc3RlckxlZ2FjeUFtaW5vQ29kZWMoY2RjICpjb2RlYy5MZWdhY3lBbWlubykgewoJdHlwZXMuUmVnaXN0ZXJMZWdhY3lBbWlub0NvZGVjKGNkYykKfQoKLy8gRGVmYXVsdEdlbmVzaXMgcmV0dXJucyBkZWZhdWx0IGdlbmVzaXMgc3RhdGUgYXMgcmF3IGJ5dGVzIGZvciB0aGUgZGlzdHJpYnV0aW9uCi8vIG1vZHVsZS4KZnVuYyAoQXBwTW9kdWxlQmFzaWMpIERlZmF1bHRHZW5lc2lzKGNkYyBjb2RlYy5KU09OTWFyc2hhbGVyKSBqc29uLlJhd01lc3NhZ2UgewoJcmV0dXJuIGNkYy5NdXN0TWFyc2hhbEpTT04odHlwZXMuRGVmYXVsdEdlbmVzaXNTdGF0ZSgpKQp9CgovLyBWYWxpZGF0ZUdlbmVzaXMgcGVyZm9ybXMgZ2VuZXNpcyBzdGF0ZSB2YWxpZGF0aW9uIGZvciB0aGUgZGlzdHJpYnV0aW9uIG1vZHVsZS4KZnVuYyAoQXBwTW9kdWxlQmFzaWMpIFZhbGlkYXRlR2VuZXNpcyhjZGMgY29kZWMuSlNPTk1hcnNoYWxlciwgY29uZmlnIHNka2NsaWVudC5UeEVuY29kaW5nQ29uZmlnLCBieiBqc29uLlJhd01lc3NhZ2UpIGVycm9yIHsKCXZhciBkYXRhIHR5cGVzLkdlbmVzaXNTdGF0ZQoJaWYgZXJyIDo9IGNkYy5Vbm1hcnNoYWxKU09OKGJ6LCAmYW1wO2RhdGEpOyBlcnIgIT0gbmlsIHsKCQlyZXR1cm4gZm10LkVycm9yZigmcXVvdDtmYWlsZWQgdG8gdW5tYXJzaGFsICVzIGdlbmVzaXMgc3RhdGU6ICV3JnF1b3Q7LCB0eXBlcy5Nb2R1bGVOYW1lLCBlcnIpCgl9CgoJcmV0dXJuIHR5cGVzLlZhbGlkYXRlR2VuZXNpcygmYW1wO2RhdGEpCn0KCi8vIFJlZ2lzdGVyUkVTVFJvdXRlcyByZWdpc3RlcnMgdGhlIFJFU1Qgcm91dGVzIGZvciB0aGUgZGlzdHJpYnV0aW9uIG1vZHVsZS4KZnVuYyAoQXBwTW9kdWxlQmFzaWMpIFJlZ2lzdGVyUkVTVFJvdXRlcyhjbGllbnRDdHggc2RrY2xpZW50LkNvbnRleHQsIHJ0ciAqbXV4LlJvdXRlcikgewoJcmVzdC5SZWdpc3RlckhhbmRsZXJzKGNsaWVudEN0eCwgcnRyKQp9CgovLyBSZWdpc3RlckdSUENHYXRld2F5Um91dGVzIHJlZ2lzdGVycyB0aGUgZ1JQQyBHYXRld2F5IHJvdXRlcyBmb3IgdGhlIGRpc3RyaWJ1dGlvbiBtb2R1bGUuCmZ1bmMgKEFwcE1vZHVsZUJhc2ljKSBSZWdpc3RlckdSUENHYXRld2F5Um91dGVzKGNsaWVudEN0eCBzZGtjbGllbnQuQ29udGV4dCwgbXV4ICpydW50aW1lLlNlcnZlTXV4KSB7Cgl0eXBlcy5SZWdpc3RlclF1ZXJ5SGFuZGxlckNsaWVudChjb250ZXh0LkJhY2tncm91bmQoKSwgbXV4LCB0eXBlcy5OZXdRdWVyeUNsaWVudChjbGllbnRDdHgpKQp9CgovLyBHZXRUeENtZCByZXR1cm5zIHRoZSByb290IHR4IGNvbW1hbmQgZm9yIHRoZSBkaXN0cmlidXRpb24gbW9kdWxlLgpmdW5jIChBcHBNb2R1bGVCYXNpYykgR2V0VHhDbWQoKSAqY29icmEuQ29tbWFuZCB7CglyZXR1cm4gY2xpLk5ld1R4Q21kKCkKfQoKLy8gR2V0UXVlcnlDbWQgcmV0dXJucyB0aGUgcm9vdCBxdWVyeSBjb21tYW5kIGZvciB0aGUgZGlzdHJpYnV0aW9uIG1vZHVsZS4KZnVuYyAoQXBwTW9kdWxlQmFzaWMpIEdldFF1ZXJ5Q21kKCkgKmNvYnJhLkNvbW1hbmQgewoJcmV0dXJuIGNsaS5HZXRRdWVyeUNtZCgpCn0KCi8vIFJlZ2lzdGVySW50ZXJmYWNlcyBpbXBsZW1lbnRzIEludGVyZmFjZU1vZHVsZQpmdW5jIChiIEFwcE1vZHVsZUJhc2ljKSBSZWdpc3RlckludGVyZmFjZXMocmVnaXN0cnkgY2RjdHlwZXMuSW50ZXJmYWNlUmVnaXN0cnkpIHsKCXR5cGVzLlJlZ2lzdGVySW50ZXJmYWNlcyhyZWdpc3RyeSkKfQoKLy9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCgovLyBBcHBNb2R1bGUgaW1wbGVtZW50cyBhbiBhcHBsaWNhdGlvbiBtb2R1bGUgZm9yIHRoZSBkaXN0cmlidXRpb24gbW9kdWxlLgp0eXBlIEFwcE1vZHVsZSBzdHJ1Y3QgewoJQXBwTW9kdWxlQmFzaWMKCglrZWVwZXIgICAgICAgIGtlZXBlci5LZWVwZXIKCWFjY291bnRLZWVwZXIgdHlwZXMuQWNjb3VudEtlZXBlcgoJYmFua0tlZXBlciAgICB0eXBlcy5CYW5rS2VlcGVyCglzdGFraW5nS2VlcGVyIHN0YWtpbmdrZWVwZXIuS2VlcGVyCn0KCi8vIE5ld0FwcE1vZHVsZSBjcmVhdGVzIGEgbmV3IEFwcE1vZHVsZSBvYmplY3QKZnVuYyBOZXdBcHBNb2R1bGUoCgljZGMgY29kZWMuTWFyc2hhbGVyLCBrZWVwZXIga2VlcGVyLktlZXBlciwgYWNjb3VudEtlZXBlciB0eXBlcy5BY2NvdW50S2VlcGVyLAoJYmFua0tlZXBlciB0eXBlcy5CYW5rS2VlcGVyLCBzdGFraW5nS2VlcGVyIHN0YWtpbmdrZWVwZXIuS2VlcGVyLAopIEFwcE1vZHVsZSB7CglyZXR1cm4gQXBwTW9kdWxlewoJCUFwcE1vZHVsZUJhc2ljOiBBcHBNb2R1bGVCYXNpY3tjZGM6IGNkY30sCgkJa2VlcGVyOiAgICAgICAgIGtlZXBlciwKCQlhY2NvdW50S2VlcGVyOiAgYWNjb3VudEtlZXBlciwKCQliYW5rS2VlcGVyOiAgICAgYmFua0tlZXBlciwKCQlzdGFraW5nS2VlcGVyOiAgc3Rha2luZ0tlZXBlciwKCX0KfQoKLy8gTmFtZSByZXR1cm5zIHRoZSBkaXN0cmlidXRpb24gbW9kdWxlJ3MgbmFtZS4KZnVuYyAoQXBwTW9kdWxlKSBOYW1lKCkgc3RyaW5nIHsKCXJldHVybiB0eXBlcy5Nb2R1bGVOYW1lCn0KCi8vIFJlZ2lzdGVySW52YXJpYW50cyByZWdpc3RlcnMgdGhlIGRpc3RyaWJ1dGlvbiBtb2R1bGUgaW52YXJpYW50cy4KZnVuYyAoYW0gQXBwTW9kdWxlKSBSZWdpc3RlckludmFyaWFudHMoaXIgc2RrLkludmFyaWFudFJlZ2lzdHJ5KSB7CglrZWVwZXIuUmVnaXN0ZXJJbnZhcmlhbnRzKGlyLCBhbS5rZWVwZXIpCn0KCi8vIFJvdXRlIHJldHVybnMgdGhlIG1lc3NhZ2Ugcm91dGluZyBrZXkgZm9yIHRoZSBkaXN0cmlidXRpb24gbW9kdWxlLgpmdW5jIChhbSBBcHBNb2R1bGUpIFJvdXRlKCkgc2RrLlJvdXRlIHsKCXJldHVybiBzZGsuTmV3Um91dGUodHlwZXMuUm91dGVyS2V5LCBOZXdIYW5kbGVyKGFtLmtlZXBlcikpCn0KCi8vIFF1ZXJpZXJSb3V0ZSByZXR1cm5zIHRoZSBkaXN0cmlidXRpb24gbW9kdWxlJ3MgcXVlcmllciByb3V0ZSBuYW1lLgpmdW5jIChBcHBNb2R1bGUpIFF1ZXJpZXJSb3V0ZSgpIHN0cmluZyB7CglyZXR1cm4gdHlwZXMuUXVlcmllclJvdXRlCn0KCi8vIExlZ2FjeVF1ZXJpZXJIYW5kbGVyIHJldHVybnMgdGhlIGRpc3RyaWJ1dGlvbiBtb2R1bGUgc2RrLlF1ZXJpZXIuCmZ1bmMgKGFtIEFwcE1vZHVsZSkgTGVnYWN5UXVlcmllckhhbmRsZXIobGVnYWN5UXVlcmllckNkYyAqY29kZWMuTGVnYWN5QW1pbm8pIHNkay5RdWVyaWVyIHsKCXJldHVybiBrZWVwZXIuTmV3UXVlcmllcihhbS5rZWVwZXIsIGxlZ2FjeVF1ZXJpZXJDZGMpCn0KCi8vIFJlZ2lzdGVyU2VydmljZXMgcmVnaXN0ZXJzIG1vZHVsZSBzZXJ2aWNlcy4KZnVuYyAoYW0gQXBwTW9kdWxlKSBSZWdpc3RlclNlcnZpY2VzKGNmZyBtb2R1bGUuQ29uZmlndXJhdG9yKSB7Cgl0eXBlcy5SZWdpc3Rlck1zZ1NlcnZlcihjZmcuTXNnU2VydmVyKCksIGtlZXBlci5OZXdNc2dTZXJ2ZXJJbXBsKGFtLmtlZXBlcikpCgl0eXBlcy5SZWdpc3RlclF1ZXJ5U2VydmVyKGNmZy5RdWVyeVNlcnZlcigpLCBhbS5rZWVwZXIpCn0KCi8vIEluaXRHZW5lc2lzIHBlcmZvcm1zIGdlbmVzaXMgaW5pdGlhbGl6YXRpb24gZm9yIHRoZSBkaXN0cmlidXRpb24gbW9kdWxlLiBJdCByZXR1cm5zCi8vIG5vIHZhbGlkYXRvciB1cGRhdGVzLgpmdW5jIChhbSBBcHBNb2R1bGUpIEluaXRHZW5lc2lzKGN0eCBzZGsuQ29udGV4dCwgY2RjIGNvZGVjLkpTT05NYXJzaGFsZXIsIGRhdGEganNvbi5SYXdNZXNzYWdlKSBbXWFiY2kuVmFsaWRhdG9yVXBkYXRlIHsKCXZhciBnZW5lc2lzU3RhdGUgdHlwZXMuR2VuZXNpc1N0YXRlCgljZGMuTXVzdFVubWFyc2hhbEpTT04oZGF0YSwgJmFtcDtnZW5lc2lzU3RhdGUpCglhbS5rZWVwZXIuSW5pdEdlbmVzaXMoY3R4LCBnZW5lc2lzU3RhdGUpCglyZXR1cm4gW11hYmNpLlZhbGlkYXRvclVwZGF0ZXt9Cn0KCi8vIEV4cG9ydEdlbmVzaXMgcmV0dXJucyB0aGUgZXhwb3J0ZWQgZ2VuZXNpcyBzdGF0ZSBhcyByYXcgYnl0ZXMgZm9yIHRoZSBkaXN0cmlidXRpb24KLy8gbW9kdWxlLgpmdW5jIChhbSBBcHBNb2R1bGUpIEV4cG9ydEdlbmVzaXMoY3R4IHNkay5Db250ZXh0LCBjZGMgY29kZWMuSlNPTk1hcnNoYWxlcikganNvbi5SYXdNZXNzYWdlIHsKCWdzIDo9IGFtLmtlZXBlci5FeHBvcnRHZW5lc2lzKGN0eCkKCXJldHVybiBjZGMuTXVzdE1hcnNoYWxKU09OKGdzKQp9CgovLyBCZWdpbkJsb2NrIHJldHVybnMgdGhlIGJlZ2luIGJsb2NrZXIgZm9yIHRoZSBkaXN0cmlidXRpb24gbW9kdWxlLgpmdW5jIChhbSBBcHBNb2R1bGUpIEJlZ2luQmxvY2soY3R4IHNkay5Db250ZXh0LCByZXEgYWJjaS5SZXF1ZXN0QmVnaW5CbG9jaykgewoJQmVnaW5CbG9ja2VyKGN0eCwgcmVxLCBhbS5rZWVwZXIpCn0KCi8vIEVuZEJsb2NrIHJldHVybnMgdGhlIGVuZCBibG9ja2VyIGZvciB0aGUgZGlzdHJpYnV0aW9uIG1vZHVsZS4gSXQgcmV0dXJucyBubyB2YWxpZGF0b3IKLy8gdXBkYXRlcy4KZnVuYyAoQXBwTW9kdWxlKSBFbmRCbG9jayhfIHNkay5Db250ZXh0LCBfIGFiY2kuUmVxdWVzdEVuZEJsb2NrKSBbXWFiY2kuVmFsaWRhdG9yVXBkYXRlIHsKCXJldHVybiBbXWFiY2kuVmFsaWRhdG9yVXBkYXRle30KfQoKLy9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCgovLyBBcHBNb2R1bGVTaW11bGF0aW9uIGZ1bmN0aW9ucwoKLy8gR2VuZXJhdGVHZW5lc2lzU3RhdGUgY3JlYXRlcyBhIHJhbmRvbWl6ZWQgR2VuU3RhdGUgb2YgdGhlIGRpc3RyaWJ1dGlvbiBtb2R1bGUuCmZ1bmMgKEFwcE1vZHVsZSkgR2VuZXJhdGVHZW5lc2lzU3RhdGUoc2ltU3RhdGUgKm1vZHVsZS5TaW11bGF0aW9uU3RhdGUpIHsKCXNpbXVsYXRpb24uUmFuZG9taXplZEdlblN0YXRlKHNpbVN0YXRlKQp9CgovLyBQcm9wb3NhbENvbnRlbnRzIHJldHVybnMgYWxsIHRoZSBkaXN0cmlidXRpb24gY29udGVudCBmdW5jdGlvbnMgdXNlZCB0bwovLyBzaW11bGF0ZSBnb3Zlcm5hbmNlIHByb3Bvc2Fscy4KZnVuYyAoYW0gQXBwTW9kdWxlKSBQcm9wb3NhbENvbnRlbnRzKHNpbVN0YXRlIG1vZHVsZS5TaW11bGF0aW9uU3RhdGUpIFtdc2ltdHlwZXMuV2VpZ2h0ZWRQcm9wb3NhbENvbnRlbnQgewoJcmV0dXJuIHNpbXVsYXRpb24uUHJvcG9zYWxDb250ZW50cyhhbS5rZWVwZXIpCn0KCi8vIFJhbmRvbWl6ZWRQYXJhbXMgY3JlYXRlcyByYW5kb21pemVkIGRpc3RyaWJ1dGlvbiBwYXJhbSBjaGFuZ2VzIGZvciB0aGUgc2ltdWxhdG9yLgpmdW5jIChBcHBNb2R1bGUpIFJhbmRvbWl6ZWRQYXJhbXMociAqcmFuZC5SYW5kKSBbXXNpbXR5cGVzLlBhcmFtQ2hhbmdlIHsKCXJldHVybiBzaW11bGF0aW9uLlBhcmFtQ2hhbmdlcyhyKQp9CgovLyBSZWdpc3RlclN0b3JlRGVjb2RlciByZWdpc3RlcnMgYSBkZWNvZGVyIGZvciBkaXN0cmlidXRpb24gbW9kdWxlJ3MgdHlwZXMKZnVuYyAoYW0gQXBwTW9kdWxlKSBSZWdpc3RlclN0b3JlRGVjb2RlcihzZHIgc2RrLlN0b3JlRGVjb2RlclJlZ2lzdHJ5KSB7CglzZHJbdHlwZXMuU3RvcmVLZXldID0gc2ltdWxhdGlvbi5OZXdEZWNvZGVTdG9yZShhbS5jZGMpCn0KCi8vIFdlaWdodGVkT3BlcmF0aW9ucyByZXR1cm5zIHRoZSBhbGwgdGhlIGdvdiBtb2R1bGUgb3BlcmF0aW9ucyB3aXRoIHRoZWlyIHJlc3BlY3RpdmUgd2VpZ2h0cy4KZnVuYyAoYW0gQXBwTW9kdWxlKSBXZWlnaHRlZE9wZXJhdGlvbnMoc2ltU3RhdGUgbW9kdWxlLlNpbXVsYXRpb25TdGF0ZSkgW11zaW10eXBlcy5XZWlnaHRlZE9wZXJhdGlvbiB7CglyZXR1cm4gc2ltdWxhdGlvbi5XZWlnaHRlZE9wZXJhdGlvbnMoCgkJc2ltU3RhdGUuQXBwUGFyYW1zLCBzaW1TdGF0ZS5DZGMsIGFtLmFjY291bnRLZWVwZXIsIGFtLmJhbmtLZWVwZXIsIGFtLmtlZXBlciwgYW0uc3Rha2luZ0tlZXBlciwKCSkKfQo="}})],1),l._v(" "),d("h2",{attrs:{id:"app-simulator-manager"}},[d("a",{staticClass:"header-anchor",attrs:{href:"#app-simulator-manager"}},[l._v("#")]),l._v(" App Simulator manager")]),l._v(" "),d("p",[l._v("The following step is setting up the "),d("code",[l._v("SimulatorManager")]),l._v(" at the app level. This\nis required for the simulation test files on the next step.")]),l._v(" "),d("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBDdXN0b21BcHAgc3RydWN0IHsKICAuLi4KICBzbSAqbW9kdWxlLlNpbXVsYXRpb25NYW5hZ2VyCn0K"}}),l._v(" "),d("p",[l._v("Then at the instantiation of the application, we create the "),d("code",[l._v("SimulationManager")]),l._v("\ninstance in the same way we create the "),d("code",[l._v("ModuleManager")]),l._v(" but this time we only pass\nthe modules that implement the simulation functions from the "),d("code",[l._v("AppModuleSimulation")]),l._v("\ninterface described above.")]),l._v(" "),d("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBOZXdDdXN0b21BcHAoLi4uKSB7CiAgLy8gY3JlYXRlIHRoZSBzaW11bGF0aW9uIG1hbmFnZXIgYW5kIGRlZmluZSB0aGUgb3JkZXIgb2YgdGhlIG1vZHVsZXMgZm9yIGRldGVybWluaXN0aWMgc2ltdWxhdGlvbnMKICBhcHAuc20gPSBtb2R1bGUuTmV3U2ltdWxhdGlvbk1hbmFnZXIoCiAgICBhdXRoLk5ld0FwcE1vZHVsZShhcHAuYWNjb3VudEtlZXBlciksCiAgICBiYW5rLk5ld0FwcE1vZHVsZShhcHAuYmFua0tlZXBlciwgYXBwLmFjY291bnRLZWVwZXIpLAogICAgc3VwcGx5Lk5ld0FwcE1vZHVsZShhcHAuc3VwcGx5S2VlcGVyLCBhcHAuYWNjb3VudEtlZXBlciksCiAgICBvdi5OZXdBcHBNb2R1bGUoYXBwLmdvdktlZXBlciwgYXBwLmFjY291bnRLZWVwZXIsIGFwcC5zdXBwbHlLZWVwZXIpLAogICAgbWludC5OZXdBcHBNb2R1bGUoYXBwLm1pbnRLZWVwZXIpLAogICAgZGlzdHIuTmV3QXBwTW9kdWxlKGFwcC5kaXN0cktlZXBlciwgYXBwLmFjY291bnRLZWVwZXIsIGFwcC5zdXBwbHlLZWVwZXIsIGFwcC5zdGFraW5nS2VlcGVyKSwKICAgIHN0YWtpbmcuTmV3QXBwTW9kdWxlKGFwcC5zdGFraW5nS2VlcGVyLCBhcHAuYWNjb3VudEtlZXBlciwgYXBwLnN1cHBseUtlZXBlciksCiAgICBzbGFzaGluZy5OZXdBcHBNb2R1bGUoYXBwLnNsYXNoaW5nS2VlcGVyLCBhcHAuYWNjb3VudEtlZXBlciwgYXBwLnN0YWtpbmdLZWVwZXIpLAogICkKCiAgLy8gcmVnaXN0ZXIgdGhlIHN0b3JlIGRlY29kZXJzIGZvciBzaW11bGF0aW9uIHRlc3RzCiAgYXBwLnNtLlJlZ2lzdGVyU3RvcmVEZWNvZGVycygpCiAgLi4uCn0K"}})],1)}),[],!1,null,null,null);Z.default=X.exports}}]);